در این مثال
ما یه سرور خارج داریم که openVPN با پورت 1194 روش نصب هست و ما نمیتونیم بهش دسترسی مستقیم داشته باشیم 

حالا ما میخوایم با استفاده از سرور ایران ، هر چی درخواست به سرورمون روی پورت 3840 ارسال میشه رو از طریق پروتوکل gRPC بفرستیم روی پورت 1194 آی پی 222.222.222.222

---
### چک کردن اتصال با انتخاب کانال داده

[کانال داده چیست](https://github.com/ExtremeDot/GostExamples/blob/main/0-Overview.md#%DA%A9%D8%A7%D9%86%D8%A7%D9%84-%D8%AF%D8%A7%D8%AF%D9%87)

اول از همه چیز چک کنیم آیا ارتباط تونل ما برقرار میشه که بعد ترکیب کانال داده رو انتخاب کنیم.

روی سرور دستور رو با توجه به مشخصات تونل وارد میکنیم، مثلا من میخوام تونل را با otls انجام بدم

```
# SERVER KHAREJ [SERVER] - IP=222.222.222.222
gost -L relay+otls://:9000
```
روی سرور خارج بر روی پورت 9000 تونل `otls` رو اجرا میکنم.

```
# SERVER IRAN [CLIENT] - IP=55.55.55.55
gost -L :2000 -F relay+otls://222.222.222.222:9000

```
روی سرور ایران گوست رو روی پورت 2000 اجرا میکنم و میگم اطلاعات رو از سرور خارج روی تونل `otls` بر روی پورت 9000 بگیر

حالا روی سرور ایران دستور زیر رو میزنم

```
curl -4 ipinfo.io
```
باید آی پی سرور ایران رو بهم بده


حالا چون گوست روی پورت 2000 اجرا شده، اگر دستور رو روی پورت 2000 بزنم باید آی پی سرور خارج رو بهم نشون بده ، در صورتی که بعد از تایپ دستور هیچ جوابی نگرفتید یعنی تونل کار نمیکنه!


```
curl -4 --socks5 socks5://localhost:2000 curl ipinfo.io
```

----
## سرور داخلی

###### پروتوکل gRPC

```
gost -L=grpc://:3840/222.222.222.222:1194
```
##### پروتوکل tcp

```
gost -L=tcp://:3840/222.222.222.222:1194
```


سرویس گوست منتظر میمونه که براش روی پورت 3840 اطلاعات ارسال بشه
بعد تمامی اطلاعات از این پورت رو میگیره و انتقال میده روی آی پی 222.222.222.22 روی پورت 1194 که سرور اپن وی پی ان روش نصب هست.

نکته ای که هست اینه که ما باید توی تنظیمات فایل openvpn وقتی آی پی ایران رو میذاریم باید پورت رو هم از 1194 به 3840 تغییر بدیم.


###### برای آی پی نسخه 6

باید حتما openVPN سرور یا وایرگارد سرور باید از آی پی نسخه 6 ساپورت کنند.
پروتوکل وایرگارد udp هست


----

اگر بخواهیم ترافیک را از طریق پورت خاصی بین دو سرور عبور بدیم میتونیم از روش تونل استفاده کنیم

### 01 - تونل معمولی
#### SERVER خارج 
```

gost -L relay://:9000
```
روی سرور خارج گوست رو روی پورت 9000 اجرا میکنیم که منتظر دریافت اطلاعات روی این پورت بمونه

### SERVER داخل

```
gost -L tcp://:3840/222.222.222.222:1194  -F  relay://222.222.222.222:9000
```

روی سرور ایران، هر چی دیتای tcp هست رو از پورت 3840 میگیره و منتقلش میکنه رو پورت 1194 برا سرور  و این دیتا از طریق تونل روی پورت 9000 برای سرور فرستاده میشه.

...

### 02 - تونل با استفاده از otls
#### SERVER KHAREJ

```
gost -L relay+otls://:9000/:1194
```
توی این دستور یه کم تغییرات اجرا کردیم و با این دستور توی سرور خارج میگیم که هر درخواستی که روی 9000 اومد رو بفرست برا 1194، تونل ارتباطی هم از نوع `otls` هست.

.

### SERVER IRAN
```
gost  -L tcp://:1194/SERVER_KHAREJ -F relay+otls://SERVER_KHAREJ:9000
```
با این دستور توی سرور ایران، میگیم که تمای ورودی های پورت 1194 رو بفرست برای تونل `otls` رو پورت 9000 سرور خارج

وقتی تونل `otls` برقرار میشه، سرور خارج تمامی درخواست ها رو از پورت 9000 میگیره و میفرسته برا پورت 1194


---
### 03 - تونل با استفاده از mtls
#### SERVER KHAREJ

```
gost -L relay+mtls://:9000/:1194
```

این دستور هم شبیه خط قبل هست فقط نوع تونل گوست فرق میکنه و mtls هست
.

### SERVER IRAN

```
 gost  -L tcp://:1194/SERVER_KHAREJ -F relay+mtls://SERVER_KHAREJ:9000

```
